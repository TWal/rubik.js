//License: https://github.com/TWal/rubik.js/blob/master/LICENSE

Rubikjs.Twisty.FixedPiecePlace=function(){this.pieces={};this.groups={};this.turnDegree=90;this.moveQueue=[];this.isProcessingQueue=!1};Rubikjs.Twisty.FixedPiecePlace.prototype.endInit=function(){var b=this,a;for(a in this.groups)this.groups[a].pieces=this.groups[a].pieces.map(function(a){return a.map(function(a){return b.pieces[a]})})};Rubikjs.Twisty.FixedPiecePlace.prototype.makeMove=function(b,a){this.moveQueue.push({groupName:b,count:a});this.processQueue()};
Rubikjs.Twisty.FixedPiecePlace.prototype.processQueue=function(){if(!this.isProcessingQueue)if(0==this.moveQueue.length)this.isProcessingQueue=!1;else{this.isProcessingQueue=!0;var b=this;this.groups[this.moveQueue[0].groupName].makeTurn(this.moveQueue[0].count,0.5,0.05,function(){b.moveQueue=b.moveQueue.slice(1);b.isProcessingQueue=!1;b.processQueue()})}};Rubikjs.Twisty.FixedPiecePlace.Group=function(b){this.twisty=b;this.pieces=[];this.rotationAxis=[0,1,0];this.rotationCenter=[0,0,0]};
Rubikjs.Twisty.FixedPiecePlace.Group.prototype.cycle=function(b){for(var a=0;a<this.pieces.length;++a)for(var e=this.pieces[a].map(function(a){return a.movable}),d=this.pieces[a].length,f=b%d+d,c=0;c<d;++c)this.pieces[a][c].movable=e[(c+f)%d]};
Rubikjs.Twisty.FixedPiecePlace.Group.prototype.makeTurn=function(b,a,e,d){var b=-b,f=this.twisty.turnDegree*Math.PI/180*b/(a/e),c=this,i=mat4.rotate(mat4.identity(),f,c.rotationAxis),g=0,h=function(){g*e<a?(c.pieces.forEach(function(a){a.forEach(function(a){mat4.multiply(i,a.movable.mesh.transform,a.movable.mesh.transform)})}),c.twisty.rendermgr.render(),g+=1,setTimeout(h,1E3*e)):(c.cycle(b),d())};h()};
