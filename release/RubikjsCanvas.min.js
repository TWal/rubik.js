//License: https://github.com/TWal/rubik.js/blob/master/LICENSE

Rubikjs.Render.Canvas.Renderer=function(a){Rubikjs.Render.Renderer.call(this,a);if(void 0!=("canvas"==a.localName?a:void 0))try{this.ctx=a.getContext("2d"),void 0==this.ctx&&alert("No canvas :(")}catch(b){}this.triangles=[]};Rubikjs.Render.Canvas.Renderer.prototype=new Rubikjs.Render.Renderer;Rubikjs.Render.Canvas.Renderer.prototype.constructor=Rubikjs.Render.Canvas.Renderer;Rubikjs.Render.Canvas.Renderer.prototype.startFrame=function(){this.triangles=[];this.ctx.clearRect(0,0,500,500)};
Rubikjs.Render.Canvas.Renderer.prototype.render=function(a){var b=mat4.create();mat4.multiply(b,this.perspectiveMat,a.transform);for(var e=[],d=0;d<a.vertexBuffer.data.length;d+=3){var c=vec4.create();vec4.transformMat4(c,[a.vertexBuffer.data[d],a.vertexBuffer.data[d+1],a.vertexBuffer.data[d+2],1],b);c[0]=-c[0];var f=1/c[3];c[0]*=f;c[1]*=f;c[2]*=f;c[3]=1;c[0]*=-1;c[1]*=-1;c[0]+=1;c[1]+=1;c[0]*=0.5*this.element.offsetWidth;c[1]*=0.5*this.element.offsetHeight;e.push(c)}for(d=0;d<a.indexBuffer.data.length;d+=
3)b=4*a.indexBuffer.data[d],b={pt0:e[a.indexBuffer.data[d]],pt1:e[a.indexBuffer.data[d+1]],pt2:e[a.indexBuffer.data[d+2]],color:[Math.round(255*a.colorBuffer.data[b]),Math.round(255*a.colorBuffer.data[b+1]),Math.round(255*a.colorBuffer.data[b+2]),Math.round(255*a.colorBuffer.data[b+3])],zmean:0},b.zmean=(b.pt0[2]+b.pt1[2]+b.pt2[2])/3,this.triangles.push(b)};
Rubikjs.Render.Canvas.Renderer.prototype.endFrame=function(){this.triangles.sort(function(a,e){return e.zmean-a.zmean});this.ctx.clearRect(0,0,500,500);var a=this;this.triangles.forEach(function(b){a.ctx.fillStyle="rgba("+b.color[0]+", "+b.color[1]+", "+b.color[2]+", "+b.color[3]+")";a.ctx.strokeStyle=a.ctx.fillStyle;a.ctx.beginPath();a.ctx.moveTo(b.pt0[0],b.pt0[1]);a.ctx.lineTo(b.pt1[0],b.pt1[1]);a.ctx.lineTo(b.pt2[0],b.pt2[1]);a.ctx.closePath();a.ctx.fill();a.ctx.stroke()})};
Rubikjs.Render.Canvas.Renderer.prototype.createMesh=function(){return new Rubikjs.Render.Mesh};
